

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HackStack Posts</title>
  <meta name="description" content="OpenStack and other hackish things">
  <meta name="author" content="dtroyer">

  <link rel="alternate" type="application/rss+xml" title="RSS 2.0"
        href="/x/blog/feed/">
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0"
        href="/x/blog/feed/atom/">

  <link rel="shortcut icon" href="/x/favicon.ico">
  <link rel="apple-touch-icon"
        href="/x/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/x/css/base.css?v=1">
  <link rel="stylesheet" href="/x/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld"
        href="/x/css/handheld.css?v=1">
  <link rel="stylesheet"
        href="/x/css/pygments_murphy.css">

  <script
    src="/x/js/libs/modernizr-1.7.min.js">
  </script>

  <link rel="stylesheet" href="/x/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Quantico' rel='stylesheet' type='text/css'>


</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
  <div id="header" class="header_gradient theme_font">
    <h1>
      <a href="/x/">
        HackStack Posts
      </a>
    </h1>
    <h2>OpenStack and other hackish things</h2>
  </div>
  <div id="navigation" class="grid_12">
    
    
    <ul class="theme_font">
      <li>
        
        <a href="/x/" class="">Home</a>
      </li>
      <li>
        
        <a href="/x/blog" class="selected">Blog</a>
      </li>
      <li>
        
        <a href="/x/blog/archive/" class="">Archives</a>
      </li>
    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_11">
            




<article>
  <div class="blog_post">
    <header>
      <div id="plug-in-to-openstackclient"></div>
      <h1 class="blog_post_title"><a href="/x/blog/2015/03/08/plug-in-to-openstackclient/" rel="bookmark" title="Permanent Link to Plug In To OpenStackClient">Plug In To OpenStackClient</a></h1>
      <p><small><span class="blog_post_date">March 08, 2015 at 03:08 AM</span> | categories: 
        <span class="blog_post_categories"><a href='/x/blog/category/openstackclient/'>openstackclient</a></span>
      </small></p>
    </header>
    <div class="post_prose">
      
<div class="document">
<p><a class="reference external" href="http://docs.openstack.org/developer/python-openstackclient/">OpenStackClient</a> has had plugin support for a while now and it is being used by real-world OpenStack project clients such as <a class="reference external" href="https://wiki.openstack.org/wiki/Congress">Congress</a>.  I've also been using it as an entry point (ha!) for some of my experimental command setups, and so can you.</p>
<div class="section" id="osc-debug">
<h1>osc-debug</h1>
<p>I've spent a lot of time debugging OSC lately in preparation for my favorite new feature yet-to-come, support for the new <tt class="docutils literal"><span class="pre">--os-cloud</span></tt> option that takes advantage of <tt class="docutils literal"><span class="pre">os-client-config</span></tt>'s cloud configuration file abilities.  Much of this debugging is necessarily around authentication and it became obvious to me that a built-in way to see what OSC was using for authentication might be handy and <tt class="docutils literal"><span class="pre">osc-debug</span></tt> was born.</p>
<p>As far as plugins go, <a class="reference external" href="https://github.com/dtroyer/osc-debug">osc-debug</a> is pretty ordinary.  It just adds three new commands (so far) that dump internal OSC state information.</p>
<div class="section" id="api-list">
<h2>api list</h2>
<p>A mash-up of service, region and endpoint listings.  <tt class="docutils literal">api list</tt> coughs up the basic information in the service catalog returned by the Identity authentication request.  It shows the available services by type, name and region.  With a little help from the <tt class="docutils literal"><span class="pre">--long</span></tt> option it adds the actual endpoint URL and a list of the supported versions at that endpoint.</p>
<p>The version support output needs a bit of explaining.  Nearly every OpenStack service catalog is configured to include a service API version in the URL.  This means that to use a different version requires 'knowledge'.  But here we know that these versions are nearly always in the form of <tt class="docutils literal">vNNN</tt> in the URI path.</p>
<p><tt class="docutils literal">api list</tt> starts at the base URI and looks for returned version information in a couple of the usual JSON formats.  If not found it loops adding the URI path components one at a time, stopping when it finds a recognized version response.</p>
<p>The returned service catalog entries can be filtered by service type <tt class="docutils literal"><span class="pre">--type</span></tt> or service name <tt class="docutils literal"><span class="pre">--name</span></tt>.</p>
<pre class="literal-block">
osc api list
    [--type &lt;service-type&gt;]
    [--name &lt;service-name&gt;]
    [--long]
</pre>
</div>
<div class="section" id="auth-show">
<h2>auth show</h2>
<p><tt class="docutils literal">auth show</tt> displays the authentication information that OSC will use to perform authentication.  This command stops just before authentication would otherwise occur so you can see exactly what has been collected from the command line options, environment variables and <tt class="docutils literal"><span class="pre">os-client-config</span></tt> file.</p>
<p>Note that this is one of the rare 'show' commands that does not take a positional argument to determine what to show.  This is due to there being ony one thing (authentication options) to choose from, but wanting to present the output in the traditional show command format.  This makes grabbing any of these values in a shell script trivial using the <tt class="docutils literal"><span class="pre">--format</span> shell</tt> option.</p>
<p>Also, <tt class="docutils literal">os_password</tt> is not displayed, because, duh.</p>
<pre class="literal-block">
osc auth show
</pre>
</div>
<div class="section" id="auth-type-list">
<h2>auth type list</h2>
<p><tt class="docutils literal">auth type list</tt> simply lists the authentication plugin types installed and their entry point targets.  Handy to see why things are not working as expected.</p>
<pre class="literal-block">
osc auth type list
</pre>
</div>
<div class="section" id="auth-type-show">
<h2>auth type show</h2>
<p><tt class="docutils literal">auth type show</tt> shows details of the specified auth plugin type.  This includes the options that the plugin type defines.  Note that the option names are the internal names, OSC will add <tt class="docutils literal"><span class="pre">--os-</span></tt> prefix to command lise options and <tt class="docutils literal">OS_</tt> prefix, plus forcing uppercase and replacing <tt class="docutils literal">-</tt> with <tt class="docutils literal">_</tt> for environment variables.</p>
<pre class="literal-block">
osc auth type show
    &lt;auth-type&gt;
</pre>
</div>
</div>
<div class="section" id="osc-quintette">
<h1>osc-quintette</h1>
<p><a class="reference external" href="https://github.com/dtroyer/osc-quintette">osc-quintette</a> is where the experimentation really gets going.  This oddly-named <a class="footnote-reference" href="#id4" id="id2">[1]</a> plugin has a couple of things, the most interesting one is how the server create command has been extended to accept --ram, --disk and --vcpu arguments to auto-select a matching flavor for the new server.</p>
<p>While the functionality is nice, the interesting bit is how the stock commands are extended.</p>
<div class="section" id="flavor-find">
<h2>flavor find</h2>
<p>This is the functional basis for the enhanced <tt class="docutils literal">server create</tt> command, directly searching for matching flavors that meet or exceed the specified values for RAM, disk and virtual CPUs.</p>
<p>What is the difference between a <tt class="docutils literal">find</tt> and <tt class="docutils literal">list</tt> command?  I don't know yet.  <tt class="docutils literal">List</tt> + filtering == <tt class="docutils literal">find</tt> maybe, but remember, this is experimental for a reason.</p>
<pre class="literal-block">
osc flavor find
    [--ram &lt;size-mb&gt;]
    [--disk &lt;size-gb&gt;]
    [--vcpus &lt;vcpus&gt;]
</pre>
</div>
<div class="section" id="server-create">
<h2>server create</h2>
<p>Extends the stock <tt class="docutils literal">server create</tt> by adding the options to select a flavor directly based on RAM, disk and/or virtual CPUs.</p>
<pre class="literal-block">
osc server create
    [--ram &lt;size-mb&gt;]
    [--disk &lt;size-gb&gt;]
    [--vcpus &lt;vcpus&gt;]
    ...
    &lt;server-name&gt;
</pre>
</div>
<div class="section" id="server-show">
<h2>server show</h2>
<p>Another command that extends the stock version by changing the output displayed, in this case swapping <tt class="docutils literal">project_id</tt> for <tt class="docutils literal">tenant_id</tt>.  This is something that needs to be done in OSC itself as part of our &quot;never show the user a 'tenant'&quot; campaign.</p>
</div>
<div class="section" id="show-flavor">
<h2>show flavor</h2>
<p>Yes!  I can restore my long-lost <tt class="docutils literal">&lt;action&gt; &lt;object&gt;</tt> command format just by putting the right things into <tt class="docutils literal">setup.cfg</tt>.  Unfortunately, the command class does not know (yet) which command form was given to call it so changing behaviour is not yet possible.  This requires a patch to <tt class="docutils literal">cliff</tt> that is in progress and should be released soon.</p>
</div>
</div>
<div class="section" id="what-else">
<h1>What Else?</h1>
<p>Imagination is all that is required to go from here.  Go forth and plugin.</p>
<hr class="docutils" />
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>The word <cite>quintette</cite> comes directly from the name of <a class="reference external" href="http://raymondscott.com/">Raymond Scott's</a> small band in the 1930's, it is what I was listening to when I neede a name.  Much of his work from this era will sem eerily familiar to those who have seen Warner Brothers shorts scored by <a class="reference external" href="http://www.imdb.com/name/nm0006298/">Carl Stalling</a> in the 1940's and 1950's. I'm planning to propose <a class="reference external" href="https://archive.org/details/Powerhouse_657">Powerhouse</a> as the Official OpenStack Theme. Look it up...</td></tr>
</tbody>
</table>
</div>
</div>


    </div>
  </div>
</article>




          </div>
          <div id="sidebar" class="grid_1">
            <aside>
  <section>
<!--
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/x/blog/2015/03/08/plug-in-to-openstackclient/">Plug In To OpenStackClient</a></li>
      <li><a href="/x/blog/2014/10/24/how-dost-thy-cloud-know-me-let-me-count-the-ways/">How Dost Thy Cloud Know Me, Let Me Count The Ways</a></li>
      <li><a href="/x/blog/2014/10/08/first-principles-glossary/">First Principles - Glossary</a></li>
      <li><a href="/x/blog/2014/10/03/a-funny-thing-happened-on-the-way-to-the-summit/">A Funny Thing Happened On The Way To The Summit</a></li>
      <li><a href="/x/blog/2014/09/15/openstack-low-level-api/">OpenStack Low Level API</a></li>
    </ul>
-->
  </section>
<!--
  <section>
    <h1 class="post_header_gradient theme_font">From Twitter "example"</h1>
    <div id="on_twitter">
      <div id="tweets"></div>
      <a href="http://search.twitter.com/search?q=example" style="float: right">See more tweets</a>
    </div>
  </section>
-->
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/x/blog/feed/index.xml">RSS</a>
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2015
        dtroyer
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/x/js/plugins.js"></script>
  <script src="/x/js/script.js"></script>
  <script src="/x/js/jquery.tweet.js"></script>  
  <script src="/x/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>

  </body>
</html>






